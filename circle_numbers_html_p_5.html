<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CircleNumbers — Dark Animated Thread Design</title>
  <style>
    :root {
      --gap: 12px;
      --primary: #1abc9c;
      --secondary: #16a085;
      --bg: #121212;
      --card-bg: #1e1e1e;
      --text: #eeeeee;
      --btn-hover: #16a085;
    }

    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      margin: 0;
      padding: 24px;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      font-size: 24px;
      margin: 0 0 16px;
      text-align: center;
      color: var(--primary);
    }

    .panel {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--gap);
      max-width: 940px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.6);
      padding: 16px;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: var(--gap);
      align-items: end;
    }

    .row .field {
      display: grid;
      gap: 6px;
    }

    label {
      font-size: 12px;
      color: #aaa;
    }

    input[type="number"] {
      padding: 10px 12px;
      border: 1px solid #333;
      border-radius: 10px;
      background: #222;
      color: #fff;
      font-size: 14px;
    }

    .actions {
      display: flex;
      gap: var(--gap);
      flex-wrap: wrap;
      margin-top: 12px;
    }

    button {
      cursor: pointer;
      border: 0;
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 600;
      background: var(--primary);
      color: #fff;
      transition: all 0.3s ease;
    }

    button:hover {
      background: var(--btn-hover);
      transform: scale(1.05);
    }

    button.secondary {
      background: #333;
      color: #1abc9c;
    }

    button.secondary:hover {
      background: var(--secondary);
      color: #fff;
      transform: scale(1.05);
    }

    #previewWrap {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    #meta {
      font-size: 12px;
      color: #888;
      text-align: center;
    }

    canvas {
      background: #121212;
      border-radius: 12px;
      box-shadow: inset 0 0 0 1px #333;
      display: block;
      margin: 0 auto;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.3/lib/p5.min.js"></script>
</head>
<body>
  <div class="panel">
    <h1>CircleNumbers — Dark Animated Thread Design</h1>

    <div class="card">
      <div class="row">
        <div class="field">
          <label for="count">count (개수)</label>
          <input id="count" type="number" min="1" step="1" value="120" />
        </div>
        <div class="field">
          <label for="radius">radius (mm)</label>
          <input id="radius" type="number" min="1" step="0.1" value="150" />
        </div>
        <div class="field">
          <label for="fontSize">font_size (px)</label>
          <input id="fontSize" type="number" min="1" step="0.5" value="12" />
        </div>
        <div class="field">
          <label for="margin">margin (mm)</label>
          <input id="margin" type="number" min="0" step="0.1" value="10" />
        </div>
      </div>
      <div class="actions">
        <button id="apply">미리보기 업데이트</button>
        <button id="saveSvg" class="secondary">실제 크기 SVG 저장</button>
      </div>
    </div>

    <div class="card" id="previewWrap">
      <div id="meta">미리보기 — 애니메이션 스레드와 숫자 라벨</div>
      <div id="sketch"></div>
    </div>
  </div>

<script>
// ===== Utilities =====
const PX_PER_MM = 96 / 25.4;
function mmToPx(mm) { return mm * PX_PER_MM; }
function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

const ui = {
  count: document.getElementById('count'),
  radius: document.getElementById('radius'),
  fontSize: document.getElementById('fontSize'),
  margin: document.getElementById('margin'),
  apply: document.getElementById('apply'),
  saveSvg: document.getElementById('saveSvg')
};

function getParams(){
  const count = Math.max(1, Math.floor(+ui.count.value || 1));
  const radiusMM = Math.max(1, +ui.radius.value || 1);
  const fontSizePX = Math.max(1, +ui.fontSize.value || 1);
  const marginMM = Math.max(0, +ui.margin.value || 0);
  return { count, radiusMM, fontSizePX, marginMM };
}

// ===== p5 Animated Sketch =====
let currentSketch = null;
function makeSketch(){
  return (s) => {
    let count, radiusMM, fontSizePX, marginMM;
    let Wpx, Hpx, scale;
    let cx, cy, radiusPx;
    const threads = [];

    s.setup = () => {
      const params = getParams();
      ({count, radiusMM, fontSizePX, marginMM} = params);

      const diameterMM = radiusMM * 2;
      const fullWpx = mmToPx(diameterMM + 2*marginMM);
      const maxSide = 720;
      scale = Math.min(1, maxSide / fullWpx);
      Wpx = Math.ceil(fullWpx * scale);
      Hpx = Wpx;

      const cnv = s.createCanvas(Wpx, Hpx);
      cnv.parent('sketch');
      s.textAlign(s.CENTER, s.CENTER);
      s.angleMode(s.RADIANS);
      cx = Wpx/2; cy = Hpx/2;
      radiusPx = mmToPx(radiusMM) * scale;

      // Initialize animated threads
      for(let i=0;i<count;i++){
        threads.push({
          angle: 2*Math.PI*i/count,
          speed: (Math.random()*0.002 + 0.001) * (Math.random() > 0.5 ? 1 : -1),
          offset: Math.random()*5
        });
      }
    };

    s.draw = () => {
      s.background('#121212');

      // Draw animated threads
      s.strokeWeight(1.5);
      for(let t of threads){
        t.angle += t.speed;
        const x1 = cx + radiusPx * Math.cos(t.angle);
        const y1 = cy + radiusPx * Math.sin(t.angle);
        const x2 = cx + (radiusPx - 20) * Math.cos(t.angle + t.offset);
        const y2 = cy + (radiusPx - 20) * Math.sin(t.angle + t.offset);
        s.stroke(30, 200, 180, 180);
        s.line(x1, y1, x2, y2);
      }

      // Draw circle numbers
      const fontMajor = fontSizePX * scale;
      const fontMinor = clamp(fontSizePX - 3, 1, 999) * scale;
      for (let i=0;i<count;i++){
        const angle = 2*Math.PI*i/count;
        const x = cx + radiusPx * Math.cos(angle);
        const y = cy + radiusPx * Math.sin(angle);
        const isMajor = (i % 5 === 0);
        const label = isMajor ? String(i) : String(i % 10);
        s.push();
        s.translate(x, y);
        s.rotate(angle);
        s.fill('#1abc9c');
        s.textSize(isMajor ? fontMajor : fontMinor);
        s.text('\u2501'+label, 0, 0);
        s.pop();
      }
    };
  };
}

function refreshSketch(){
  if(currentSketch){ currentSketch.remove(); }
  document.getElementById('sketch').innerHTML = '';
  currentSketch = new p5(makeSketch(), 'sketch');
}

ui.apply.addEventListener('click', refreshSketch);
refreshSketch();

// ===== SVG Save =====
function generateSVGString(){
  const {count, radiusMM, fontSizePX, marginMM} = getParams();
  const diameterMM = radiusMM * 2;
  const widthMM = diameterMM + 2*marginMM;
  const heightMM = widthMM;
  const widthPX = mmToPx(widthMM);
  const heightPX = mmToPx(heightMM);
  const cxPX = widthPX/2;
  const cyPX = heightPX/2;
  const radiusPX = mmToPx(radiusMM);
  const fontMinorPX = clamp(fontSizePX - 3, 1, 999);

  let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${widthMM}mm" height="${heightMM}mm" viewBox="0 0 ${widthPX} ${heightPX}">\n`;
  svg += `  <g id="circle-numbers" font-family="Arial, Helvetica, sans-serif" text-anchor="middle" dominant-baseline="middle" fill="#1abc9c">\n`;

  for(let i=0;i<count;i++){
    const angle = 2*Math.PI*i/count;
    const x = cxPX + radiusPX * Math.cos(angle);
    const y = cyPX + radiusPX * Math.sin(angle);
    const isMajor = (i % 5 === 0);
    const label = isMajor ? String(i) : String(i % 10);
    const fontSize = isMajor ? fontSizePX : fontMinorPX;
    const deg = angle * 180 / Math.PI;
    svg += `    <text font-size="${fontSize}px" transform="rotate(${deg},${x},${y})">` +
           `<tspan x="${x}" y="${y}">\u2501${label}</tspan>` +
           `</text>\n`;
  }
  svg += `  </g>\n</svg>`;
  return svg;
}

ui.saveSvg.addEventListener('click', () => {
  const svg = generateSVGString();
  const blob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const {count, radiusMM} = getParams();
  a.href = url;
  a.download = `CircleNumbers_r${radiusMM}mm_c${count}.svg`;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
});
</script>
</body>
</html>
